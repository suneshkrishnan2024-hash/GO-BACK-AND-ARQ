<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Go-Back-N ARQ â€” Teaching Simulator</title>
  <link rel="stylesheet" href="css/style.css"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
</head>

<body>
  <div id="app">

    <!-- HEADER -->
    <header class="glass header">
      <div class="header-top">
        <h1>Go-Back-N ARQ â€” Visual Simulator</h1>
        <nav class="header-actions">
          <button class="btn pill" id="btnLearn">Learn</button>
          <button class="btn pill" id="btnDev">Developed By</button>
          <button class="btn pill" id="btnHelp">Help</button>
          <button class="btn pill" id="btnDownload">Download</button>
        </nav>
      </div>
      <p class="tagline">Sliding window, cumulative ACKs; timeout â‡’ retransmit from base. ACKs only after arrival.</p>
    </header>

    <!-- DASHBOARD -->
    <section class="glass controls-wrap">
      <div class="controls-grid">

        <label>Number of Frames
          <input id="numFrames" type="number" min="1" max="300" value="10"/>
        </label>

        <label>Window Size (N)
          <input id="winSize" type="number" min="1" max="32" value="4"/>
        </label>

        <label>Timeout (ms)
          <input id="timeout" type="number" min="2000" max="60000" value="6000"/>
        </label>

        <label>Frame Loss %
          <input id="lossPercent" type="range" min="0" max="80" value="15"/>
          <span class="inline-val" id="lossPercentVal">15%</span>
        </label>

        <label>Frame Loss Mode
          <select id="lossMode">
            <option value="random">Random (by %)</option>
            <option value="specific">Specific frame(s)</option>
            <option value="everyk">Every k-th</option>
            <option value="none">None</option>
          </select>
        </label>

        <label id="wrapSpecific" class="hidden">Specific Frames (comma)
          <input id="specificFrames" type="text" placeholder="e.g. 2,7,9"/>
        </label>

        <label id="wrapEveryK" class="hidden">k (every k-th)
          <input id="everyK" type="number" min="1" value="3"/>
        </label>

        <label>Frame Delay Mode
          <select id="frameDelayMode">
            <option value="none">None</option>
            <option value="specific">Delay specific frame(s)</option>
            <option value="everyk">Delay every k-th</option>
          </select>
        </label>

        <label id="wrapDelaySpec" class="hidden">Delay Frame # / k
          <input id="frameDelaySpec" type="text" placeholder="e.g. 5 or 3"/>
        </label>

        <label id="wrapDelayMs" class="hidden">Frame Delay (ms)
          <input id="frameDelayMs" type="number" min="0" value="1200"/>
        </label>

        <label>ACK Loss %
          <input id="ackLossPercent" type="range" min="0" max="80" value="5"/>
          <span class="inline-val" id="ackLossVal">5%</span>
        </label>

        <label>ACK Loss Mode
          <select id="ackLossMode">
            <option value="random">Random (by %)</option>
            <option value="specific">Specific ACK(s)</option>
            <option value="everyk">Every k-th ACK</option>
            <option value="none">None</option>
          </select>
        </label>

        <label id="wrapAckSpec" class="hidden">Specific ACK #
          <input id="ackSpecific" type="text" placeholder="e.g. 0,3,7"/>
        </label>

        <label id="wrapAckK" class="hidden">k (every k-th ACK)
          <input id="ackEveryK" type="number" min="1" value="3"/>
        </label>

        <label>ACK Delay (ms)
          <input id="ackDelayMs" type="number" min="0" value="800"/>
        </label>

        <label>Simulation Mode
          <select id="simMode">
            <option value="textbook">Textbook diagonals</option>
            <option value="vertical">Vertical columns</option>
            <option value="replay">Animated replay</option>
          </select>
        </label>

        <label>Summary Diagram
          <select id="diagramType">
            <option value="vertical">Vertical two-columns</option>
            <option value="textbook">Textbook diagonals</option>
            <option value="animated">Animated replay</option>
          </select>
        </label>

      </div>

      <div class="controls-actions">
        <button class="btn primary" id="startBtn">Start</button>
        <button class="btn" id="stepBtn">Step</button>
        <button class="btn danger" id="resetBtn">Reset</button>
      </div>
    </section>

    <!-- SIMULATION -->
    <section class="glass sim-shell">
      <div class="lanes">
        <div class="lane">
          <h3>Sender</h3>
          <div id="senderWindow" class="window"></div>
          <div id="senderQueue" class="queue"></div>
        </div>

        <div class="channel">
          <svg id="liveSvg" width="100%" height="100%"></svg>
          <div id="channelStage"></div>
          <div class="axis axis-left">Sender</div>
          <div class="axis axis-right">Receiver</div>
        </div>

        <div class="lane">
          <h3>Receiver</h3>
          <div id="recvArea" class="recv"></div>
        </div>
      </div>
    </section>

    <!-- EVENT LOG -->
    <section class="glass log-shell">
      <h3>Event Log</h3>
      <div id="events" class="log"></div>
    </section>

    <!-- SUMMARY -->
    <section class="glass hidden" id="statsWrap">
      <h3>ðŸ“Š Simulation Results</h3>

      <div class="stats">
        <div class="stat-card"><div class="stat-label">Total original frames</div><div class="stat-value" id="stat_totalFrames">0</div></div>
        <div class="stat-card"><div class="stat-label">Total transmissions</div><div class="stat-value" id="stat_totalTrans">0</div></div>
        <div class="stat-card"><div class="stat-label">Frames delivered</div><div class="stat-value" id="stat_delivered">0</div></div>
        <div class="stat-card"><div class="stat-label">Total ACKs generated</div><div class="stat-value" id="stat_totalAcks">0</div></div>
        <div class="stat-card"><div class="stat-label">Frames lost</div><div class="stat-value" id="stat_framesLost">0</div></div>
        <div class="stat-card"><div class="stat-label">ACKs lost</div><div class="stat-value" id="stat_acksLost">0</div></div>
        <div class="stat-card"><div class="stat-label">Frames delayed</div><div class="stat-value" id="stat_framesDelayed">0</div></div>
        <div class="stat-card"><div class="stat-label">Efficiency</div><div class="stat-value" id="stat_efficiency">0%</div></div>
        <div class="stat-card"><div class="stat-label">Frames / second</div><div class="stat-value" id="stat_fps">0</div></div>
      </div>

      <div class="diagram-wrap">
        <h4>Flow Diagram (<span id="diagramModeLabel">Vertical two-columns</span>)</h4>
        <div id="diagramHost" class="diagram-host glass-lite"></div>
      </div>
    </section>

    <footer class="footer">
      Created by <b>Sunesh Krishnan N</b> (24BCE1925) & <b>Aravind G</b> (24BCE1293) Â· Guided by <b>Dr. Swaminathan Annadurai</b>
    </footer>

  </div>

  <!-- MODAL: LEARN -->
  <div class="modal hidden" id="modalLearn">
    <div class="modal-card">
      <div class="modal-head">
        <h3>Learn: Go-Back-N ARQ â€” Visual Guide</h3>
        <button class="icon-btn" data-close="modalLearn">âœ•</button>
      </div>
      <div class="modal-body">

        <p>Go-Back-N ARQ is a sliding window protocol that improves efficiency by letting the sender transmit multiple frames before needing ACKs.</p>

        <h4>ðŸ”¹ How It Works</h4>
        <ul class="bullets">
          <li>Sender can send up to <b>N</b> unacknowledged frames.</li>
          <li>Receiver sends <b>cumulative ACKs</b>.</li>
          <li>Timeout triggers retransmission from the base frame.</li>
        </ul>

      </div>
    </div>
  </div>

  <!-- MODAL: DEVELOPED BY -->
  <div class="modal hidden" id="modalDev">
    <div class="modal-card">
      <div class="modal-head">
        <h3>Developed By</h3>
        <button class="icon-btn" data-close="modalDev">âœ•</button>
      </div>

      <div class="modal-body dev-grid">

        <!-- You -->
        <div class="dev-card">
          <img src="img/sunesh.jpg" class="dev-photo">
          <div class="dev-name">Sunesh Krishnan N</div>
          <div class="dev-reg">Reg No: 24BCE1925</div>
        </div>

        <!-- Aravind -->
        <div class="dev-card">
          <img src="img/aravind.jpg" class="dev-photo">
          <div class="dev-name">Aravind G</div>
          <div class="dev-reg">Reg No: 24BCE1293</div>
        </div>

        <!-- Professor -->
        <div class="dev-prof">
          <img src="img/professor.jpg" alt="Dr. Swaminathan Annadurai"/>
          <div class="dev-caption">
            <b>Dr. Swaminathan Annadurai</b><br/>Professor & Guide
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- MODAL: HELP -->
  <div class="modal hidden" id="modalHelp">
    <div class="modal-card">
      <div class="modal-head">
        <h3>Help & Usage Guide</h3>
        <button class="icon-btn" data-close="modalHelp">âœ•</button>
      </div>
      <div class="modal-body">

        <p>This simulator lets you visualize how Go-Back-N ARQ behaves under different network conditions.</p>

      </div>
    </div>
  </div>

  <script src="js/app.js"></script>
</body>
</html>
